import{z as re,Q as j,r as A,c,w as R,D as ce,h as H,I as fe,E as de,g as ve,H as ge}from"./index.bc8d72d5.js";import{u as he,a as me,b as ye,v as p,c as ke,d as xe,e as Pe,f as Ce,g as Te,h as we,i as Se,r as L,s as be,p as Q,j as Oe,k as Ee}from"./position-engine.3a8798e1.js";import{u as qe,a as Be}from"./use-dark.806e4198.js";import{u as Fe,a as De}from"./use-timeout.fa69ba0b.js";import{c as Ke,h as Me}from"./render.0b265221.js";import{g as Ae}from"./scroll.825bdcd3.js";import{a as Re}from"./dom.31397dd6.js";import{a as He}from"./focus-manager.d6507951.js";const s=[];let f;function pe(e){f=e.keyCode===27}function Le(){f===!0&&(f=!1)}function Qe(e){f===!0&&(f=!1,re(e,27)===!0&&s[s.length-1](e))}function I(e){window[e]("keydown",pe),window[e]("blur",Le),window[e]("keyup",Qe),f=!1}function We(e){j.is.desktop===!0&&(s.push(e),s.length===1&&I("addEventListener"))}function W(e){const o=s.indexOf(e);o>-1&&(s.splice(o,1),s.length===0&&I("removeEventListener"))}const u=[];function _(e){u[u.length-1](e)}function je(e){j.is.desktop===!0&&(u.push(e),u.length===1&&document.body.addEventListener("focusin",_))}function Ie(e){const o=u.indexOf(e);o>-1&&(u.splice(o,1),u.length===0&&document.body.removeEventListener("focusin",_))}var Xe=Ke({name:"QMenu",inheritAttrs:!1,props:{...he,...me,...qe,...ye,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:p},self:{type:String,validator:p},offset:{type:Array,validator:ke},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...xe,"click","escapeKey"],setup(e,{slots:o,emit:g,attrs:m}){let i=null,h,d,y;const w=ve(),{proxy:k}=w,{$q:n}=k,a=A(null),l=A(!1),$=c(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),z=Be(e,n),{registerTick:U,removeTick:G}=Fe(),{registerTimeout:S}=De(),{transitionProps:J,transitionStyle:N}=Pe(e),{localScrollTarget:b,changeScrollEvent:V,unconfigureScrollTarget:X}=Ce(e,K),{anchorEl:r,canShow:Y}=Te({showing:l}),{hide:O}=we({showing:l,canShow:Y,handleShow:ne,handleHide:ae,hideOnRouteChange:$,processOnMount:!0}),{showPortal:E,hidePortal:q,renderPortal:Z}=Se(w,a,ue,"menu"),x={anchorEl:r,innerRef:a,onClickOutside(t){if(e.persistent!==!0&&l.value===!0)return O(t),(t.type==="touchstart"||t.target.classList.contains("q-dialog__backdrop"))&&ge(t),!0}},B=c(()=>Q(e.anchor||(e.cover===!0?"center middle":"bottom start"),n.lang.rtl)),ee=c(()=>e.cover===!0?B.value:Q(e.self||"top start",n.lang.rtl)),te=c(()=>(e.square===!0?" q-menu--square":"")+(z.value===!0?" q-menu--dark q-dark":"")),oe=c(()=>e.autoClose===!0?{onClick:se}:{}),F=c(()=>l.value===!0&&e.persistent!==!0);R(F,t=>{t===!0?(We(C),Ee(x)):(W(C),L(x))});function P(){He(()=>{let t=a.value;t&&t.contains(document.activeElement)!==!0&&(t=t.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.querySelector("[autofocus], [data-autofocus]")||t,t.focus({preventScroll:!0}))})}function ne(t){if(i=e.noRefocus===!1?document.activeElement:null,je(M),E(),K(),h=void 0,t!==void 0&&(e.touchPosition||e.contextMenu)){const T=ce(t);if(T.left!==void 0){const{top:ie,left:le}=r.value.getBoundingClientRect();h={left:T.left-le,top:T.top-ie}}}d===void 0&&(d=R(()=>n.screen.width+"|"+n.screen.height+"|"+e.self+"|"+e.anchor+"|"+n.lang.rtl,v)),e.noFocus!==!0&&document.activeElement.blur(),U(()=>{v(),e.noFocus!==!0&&P()}),S(()=>{n.platform.is.ios===!0&&(y=e.autoClose,a.value.click()),v(),E(!0),g("show",t)},e.transitionDuration)}function ae(t){G(),q(),D(!0),i!==null&&(t===void 0||t.qClickOutside!==!0)&&(((t&&t.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),S(()=>{q(!0),g("hide",t)},e.transitionDuration)}function D(t){h=void 0,d!==void 0&&(d(),d=void 0),(t===!0||l.value===!0)&&(Ie(M),X(),L(x),W(C)),t!==!0&&(i=null)}function K(){(r.value!==null||e.scrollTarget!==void 0)&&(b.value=Ae(r.value,e.scrollTarget),V(b.value,v))}function se(t){y!==!0?(Oe(k,t),g("click",t)):y=!1}function M(t){F.value===!0&&e.noFocus!==!0&&Re(a.value,t.target)!==!0&&P()}function C(t){g("escapeKey"),O(t)}function v(){const t=a.value;t===null||r.value===null||be({el:t,offset:e.offset,anchorEl:r.value,anchorOrigin:B.value,selfOrigin:ee.value,absoluteOffset:h,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ue(){return H(fe,J.value,()=>l.value===!0?H("div",{role:"menu",...m,ref:a,tabindex:-1,class:["q-menu q-position-engine scroll"+te.value,m.class],style:[m.style,N.value],...oe.value},Me(o.default)):null)}return de(D),Object.assign(k,{focus:P,updatePosition:v}),Z}});export{Xe as Q,W as a,je as b,We as c,Ie as r};
